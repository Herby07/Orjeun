<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formations - Orjeun</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>tailwind.config={theme:{extend:{colors:{primary:'#0066CC',secondary:'#E6F0FF'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
body {
font-family: 'Poppins', sans-serif;
background-color: #f9f9f9;
}
.card-animation {
transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card-animation:hover {
transform: translateY(-5px);
box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}
.participate-btn:active {
transform: scale(0.98);
}
.badge-online {
background-color: #e0f7fa;
color: #00838f;
padding: 3px 8px;
border-radius: 12px;
font-size: 0.75rem;
font-weight: 500;
}
.badge-professional {
background-color: #e8f5e9;
color: #2e7d32;
padding: 3px 8px;
border-radius: 12px;
font-size: 0.75rem;
font-weight: 500;
}
.detail-item {
display: flex;
align-items: center;
margin-top: 4px;
}
.detail-item i {
margin-right: 8px;
color: #0066CC;
}
.progress-bar {
height: 6px;
background-color: #e0e0e0;
border-radius: 3px;
overflow: hidden;
margin-top: 8px;
}
.progress-fill {
height: 100%;
background-color: #4CAF50;
border-radius: 3px;
transition: width 0.5s ease;
}
.progress-text {
font-size: 0.75rem;
color: #666;
text-align: right;
margin-top: 2px;
}
.action-buttons {
display: flex;
gap: 8px;
justify-content: flex-end;
}
</style>
</head>
<body class="bg-white">
<nav class="bg-white fixed top-0 left-0 w-full z-50 shadow px-4 py-3 flex justify-between items-center">
    <h1 class="text-xl font-bold text-primary">ORJEUN</h1>
    <div class="flex items-center gap-4">
      <div class="flex items-center">
        <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-500">
          <i class="ri-user-line"></i>
        </div>
        <span class="ml-2 font-medium">Visiteur</span>
      </div>
    </div>
</nav>

<!-- Main Content -->
<main class="pt-16 pb-20 px-4">
<div class="mt-4 mb-6">
<h2 class="text-2xl font-semibold">Formations</h2>
<p class="text-gray-600 mt-1">Découvrez nos formations professionnelles et en ligne</p>
</div>

<!-- Search Bar -->
<div class="relative mb-6">
<input type="text" id="searchInput" placeholder="Rechercher une formation..." class="w-full py-3 pl-10 pr-4 rounded-lg border border-gray-200 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
<div class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 flex items-center justify-center text-gray-400">
<i class="ri-search-line"></i>
</div>
</div>

<!-- Loading State -->
<div id="loadingState" class="flex flex-col items-center justify-center py-10">
<div class="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
<p class="mt-4 text-gray-600">Chargement des formations...</p>
</div>

<!-- Error State -->
<div id="errorState" class="hidden flex flex-col items-center justify-center py-10 text-center">
<div class="w-16 h-16 flex items-center justify-center text-red-500 mb-4">
<i class="ri-error-warning-line ri-3x"></i>
</div>
<h3 class="text-lg font-medium text-gray-900">Impossible de charger les formations</h3>
<p class="mt-2 text-gray-600">Veuillez vérifier votre connexion et réessayer</p>
<button id="retryButton" class="mt-4 px-4 py-2 bg-primary text-white rounded-button cursor-pointer">
Réessayer
</button>
</div>

<!-- Formations List -->
<div id="formationsList" class="hidden space-y-6"></div>
</main>

<!-- Tab Bar -->
<div class="fixed bottom-0 left-0 w-full bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] px-2 py-2 grid grid-cols-5 gap-1">
    <a href="#" class="flex flex-col items-center justify-center text-gray-500">
        <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-home-5-fill ri-lg"></i>
        </div>
        <span class="text-xs mt-1">Accueil</span>
    </a>
    <a href="#" class="flex flex-col items-center justify-center text-primary">
        <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-book-open-line ri-lg"></i>
        </div>
        <span class="text-xs mt-1">Formations</span>
    </a>
    <a href="forum.html" class="flex flex-col items-center justify-center text-gray-500">
        <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-discuss-line ri-lg"></i>
        </div>
        <span class="text-xs mt-1">Forum</span>
    </a>
    <a href="radio.html" class="flex flex-col items-center justify-center text-gray-500">
        <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-radio-2-line ri-lg"></i>
        </div>
        <span class="text-xs mt-1">Radio</span>
    </a>
    <a href="market.html" class="flex flex-col items-center justify-center text-gray-500">
        <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-shopping-bag-line ri-lg"></i>
        </div>
        <span class="text-xs mt-1">Boutique</span>
    </a>
</div>

<!-- Formation Card Template (Hidden) -->
<template id="formationCardTemplate">
<div class="formation-card bg-white rounded-lg shadow-md overflow-hidden card-animation">
<div class="p-4">
<div class="flex justify-between items-start">
  <h3 class="formation-title text-lg font-semibold"></h3>
  <span class="formation-type-badge"></span>
</div>

<div class="formation-details mt-3">
  <!-- Détails pour les formations professionnelles -->
  <div class="professional-details hidden">
    <div class="detail-item">
      <i class="ri-map-pin-line"></i>
      <span class="formation-lieu"></span>
    </div>
    <div class="detail-item">
      <i class="ri-calendar-line"></i>
      <span class="formation-date"></span>
    </div>
    <div class="detail-item">
      <i class="ri-time-line"></i>
      <span class="formation-heure"></span>
    </div>
  </div>
  
  <!-- Détails pour les formations en ligne -->
  <div class="online-details hidden">
    <div class="detail-item">
      <i class="ri-computer-line"></i>
      <span>Formation en ligne</span>
    </div>
    
    <!-- Nouveau : afficher le nombre de blocs de contenu -->
    <div class="detail-item">
      <i class="ri-stack-line"></i>
      <span class="formation-content-count"></span>
    </div>
    
    <!-- Nouveau : afficher le nombre de quiz -->
    <div class="detail-item">
      <i class="ri-question-line"></i>
      <span class="formation-quiz-count"></span>
    </div>
  </div>
</div>

<p class="formation-description mt-3 text-gray-700 text-sm"></p>

<div class="mt-4 action-buttons">
  <button class="participate-btn bg-primary text-white px-4 py-2 rounded-button flex items-center cursor-pointer">
    <div class="w-4 h-4 flex items-center justify-center mr-1">
      <i class="formation-btn-icon"></i>
    </div>
    <span class="formation-btn-text"></span>
  </button>
</div>
</div>
</div>
</template>

<script>
// Configuration Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDzo0khblPEzq28bS0ZuZmSMBqJm87WtNM",
  authDomain: "orjeun-9dec4.firebaseapp.com",
  databaseURL: "https://orjeun-9dec4-default-rtdb.firebaseio.com",
  projectId: "orjeun-9dec4",
  storageBucket: "orjeun-9dec4.appspot.com",
  messagingSenderId: "979782321937",
  appId: "1:979782321937:web:5b3971dba3240ae4b16eb0",
  measurementId: "G-G316HCYF9E"
};

// Initialisation Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

document.addEventListener('DOMContentLoaded', function() {
  let originalFormations = [];
  
  const loadFormations = async () => {
    try {
      const snapshot = await database.ref('formations').once('value');
      document.getElementById('loadingState').classList.add('hidden');
      
      if (snapshot.exists()) {
        const formationsData = snapshot.val();
        // Convertir l'objet en tableau
        originalFormations = Object.entries(formationsData).map(([id, formation]) => ({ id, ...formation }));
        renderFormations(originalFormations);
        document.getElementById('formationsList').classList.remove('hidden');
      } else {
        showEmptyState();
      }
    } catch (error) {
      console.error("Erreur de chargement:", error);
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('errorState').classList.remove('hidden');
    }
  };

  const showEmptyState = () => {
    document.getElementById('formationsList').innerHTML = `
      <div class="text-center py-10">
        <div class="w-16 h-16 mx-auto flex items-center justify-center text-gray-400">
          <i class="ri-inbox-line ri-3x"></i>
        </div>
        <h3 class="mt-4 text-lg font-medium">Aucune formation programmée</h3>
        <p class="mt-2 text-sm text-gray-600">Revenez plus tard pour de nouvelles formations</p>
      </div>`;
  };

  const renderFormations = (formations) => {
    const listElement = document.getElementById('formationsList');
    listElement.innerHTML = '';

    for (const formation of formations) {
      const template = document.getElementById('formationCardTemplate');
      const clone = document.importNode(template.content, true);

      clone.querySelector('.formation-title').textContent = formation.titre;
      clone.querySelector('.formation-description').textContent = formation.description || "Aucune description disponible";
      
      // Déterminer le type de formation
      const isOnline = formation.type === 'online';
      const badgeElement = clone.querySelector('.formation-type-badge');
      
      if (isOnline) {
        badgeElement.textContent = 'En ligne';
        badgeElement.classList.add('badge-online');
        
        // Afficher les détails en ligne
        const onlineDetails = clone.querySelector('.online-details');
        onlineDetails.classList.remove('hidden');
        
        // Compter les blocs de contenu et les quiz
        let contentCount = 0;
        let quizCount = 0;
        
        if (formation.content && Array.isArray(formation.content)) {
          contentCount = formation.content.length;
          
          // Compter les quiz
          formation.content.forEach(block => {
            if (block.type === 'quiz') quizCount++;
          });
        }
        
        clone.querySelector('.formation-content-count').textContent = `${contentCount} blocs de contenu`;
        clone.querySelector('.formation-quiz-count').textContent = `${quizCount} quiz`;
      } else {
        badgeElement.textContent = 'Professionnelle';
        badgeElement.classList.add('badge-professional');
        
        // Afficher les détails professionnels
        const professionalDetails = clone.querySelector('.professional-details');
        professionalDetails.classList.remove('hidden');
        
        clone.querySelector('.formation-lieu').textContent = formation.lieu || 'Non spécifié';
        
        if (formation.date) {
          const dateObj = new Date(formation.date);
          clone.querySelector('.formation-date').textContent = dateObj.toLocaleDateString('fr-FR');
        } else {
          clone.querySelector('.formation-date').textContent = 'Date non définie';
        }
        
        clone.querySelector('.formation-heure').textContent = formation.heure ? 
          `À ${formation.heure}` : 'Heure non définie';
      }

      // Personnaliser les boutons d'action
      const actionBtn = clone.querySelector('.participate-btn');
      const actionBtnIcon = clone.querySelector('.formation-btn-icon');
      const actionBtnText = clone.querySelector('.formation-btn-text');
      
      if (isOnline) {
        actionBtnText.textContent = 'Commencer';
        actionBtnIcon.className = 'ri-play-circle-line';
      } else {
        actionBtnText.textContent = 'Contacter';
        actionBtnIcon.className = 'ri-whatsapp-line';
      }

      // Gestion du clic sur le bouton d'action
      actionBtn.addEventListener('click', (e) => {
        // Afficher une alerte demandant l'inscription
        showRegistrationAlert(formation.titre);
      });

      listElement.appendChild(clone);
    }
  };

  // Fonction pour afficher l'alerte d'inscription
  function showRegistrationAlert(formationTitle) {
    const alertHTML = `
      <div class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
          <div class="flex justify-center mb-4">
            <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
              <i class="ri-information-line text-blue-600 text-xl"></i>
            </div>
          </div>
          <h3 class="text-lg font-semibold text-center mb-2">Accès réservé aux membres</h3>
          <p class="text-gray-600 text-center mb-4">
            Pour accéder à la formation <span class="font-medium">"${formationTitle}"</span>, vous devez créer un compte.
          </p>
          <div class="flex justify-center gap-3">
            <button id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition">
              Fermer
            </button>
            
          </div>
        </div>
      </div>
    `;
    
    // Créer et afficher l'alerte
    const alertDiv = document.createElement('div');
    alertDiv.innerHTML = alertHTML;
    document.body.appendChild(alertDiv);
    
    // Gestion des boutons de l'alerte
    alertDiv.querySelector('#cancelBtn').addEventListener('click', () => {
      document.body.removeChild(alertDiv);
    });
    
    alertDiv.querySelector('#registerBtn').addEventListener('click', () => {
      document.body.removeChild(alertDiv);
      // Ici, normalement on redirigerait vers la page d'inscription
      alert("Fonctionnalité d'inscription bientôt disponible!");
    });
  }

  // Gestion de la recherche
  document.getElementById('searchInput').addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    const filtered = originalFormations.filter(f =>
      f.titre.toLowerCase().includes(searchTerm) ||
      (f.description && f.description.toLowerCase().includes(searchTerm)) ||
      (f.lieu && f.lieu.toLowerCase().includes(searchTerm))
    );
    renderFormations(filtered);
  });

  // Réessayer
  document.getElementById('retryButton').addEventListener('click', loadFormations);

  // Chargement initial
  loadFormations();
});
</script>
</body>
</html>